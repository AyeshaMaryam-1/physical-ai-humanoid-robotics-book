"use strict";(globalThis.webpackChunkbook_temp=globalThis.webpackChunkbook_temp||[]).push([[336],{4323:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module_1/1_2_packages","title":"Building ROS 2 Packages (Python / rclpy)","description":"Purpose","source":"@site/docs/01_module_1/1_2_packages.mdx","sourceDirName":"01_module_1","slug":"/module_1/1_2_packages","permalink":"/physical-ai-humanoid-robotics-book/docs/module_1/1_2_packages","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/01_module_1/1_2_packages.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Building ROS 2 Packages (Python / rclpy)"},"sidebar":"tutorialSidebar","previous":{"title":"Foundations of Physical AI & ROS 2","permalink":"/physical-ai-humanoid-robotics-book/docs/module_1/1_1_foundations"},"next":{"title":"Robot Description (URDF for Humanoids)","permalink":"/physical-ai-humanoid-robotics-book/docs/module_1/1_3_urdf"}}');var r=s(4848),a=s(8453);const t={sidebar_position:2,title:"Building ROS 2 Packages (Python / rclpy)"},l="Building ROS 2 Packages (Python / rclpy)",o={},c=[{value:"Purpose",id:"purpose",level:2},{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Inputs",id:"inputs",level:2},{value:"Outputs",id:"outputs",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Chapter Outline",id:"chapter-outline",level:2},{value:"1. Advanced Node Development",id:"1-advanced-node-development",level:3},{value:"2. Services and Actions",id:"2-services-and-actions",level:3},{value:"3. Message Types and Parameters",id:"3-message-types-and-parameters",level:3},{value:"4. Package Organization",id:"4-package-organization",level:3},{value:"Hands-On Lab",id:"hands-on-lab",level:2},{value:"Creating the Robot Control Basics Package",id:"creating-the-robot-control-basics-package",level:3},{value:"Safety Notes",id:"safety-notes",level:2},{value:"Evaluation Criteria",id:"evaluation-criteria",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"building-ros-2-packages-python--rclpy",children:"Building ROS 2 Packages (Python / rclpy)"})}),"\n",(0,r.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsx)(n.p,{children:"This chapter builds on the foundational ROS 2 concepts and focuses on creating more sophisticated ROS 2 Python packages. It covers advanced node development, message types, services, and best practices for organizing robotics code using the rclpy client library."}),"\n",(0,r.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,r.jsx)(n.p,{children:"After completing this chapter, you will be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create complex ROS 2 Python packages with multiple nodes"}),"\n",(0,r.jsx)(n.li,{children:"Implement services and actions for request-response communication"}),"\n",(0,r.jsx)(n.li,{children:"Design custom message types for specific robotics applications"}),"\n",(0,r.jsx)(n.li,{children:"Use parameters effectively in ROS 2 nodes"}),"\n",(0,r.jsx)(n.li,{children:"Implement proper error handling and lifecycle management in ROS 2 nodes"}),"\n",(0,r.jsx)(n.li,{children:"Structure robotics projects following ROS 2 best practices"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Understanding of basic ROS 2 concepts and node communication"}),"\n",(0,r.jsx)(n.li,{children:"Experience with Python programming"}),"\n",(0,r.jsx)(n.li,{children:"Completed Chapter 1.1: Foundations of Physical AI & ROS 2"}),"\n",(0,r.jsx)(n.li,{children:"Working ROS 2 development environment"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"inputs",children:"Inputs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Working ROS 2 installation (Humble Hawksbill or later)"}),"\n",(0,r.jsx)(n.li,{children:"Basic ROS 2 package knowledge from Chapter 1.1"}),"\n",(0,r.jsx)(n.li,{children:"Understanding of Python and object-oriented programming"}),"\n",(0,r.jsx)(n.li,{children:"Access to the development environment set up in the lab guide"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"outputs",children:"Outputs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Advanced ROS 2 Python package with multiple nodes"}),"\n",(0,r.jsx)(n.li,{children:"Custom service implementation"}),"\n",(0,r.jsx)(n.li,{children:"Parameter management system"}),"\n",(0,r.jsx)(n.li,{children:"Well-structured robotics control package"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"rclpy"}),": The Python client library for ROS 2, providing Python bindings to ROS 2"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Services"}),": Synchronous request-response communication pattern in ROS 2"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Actions"}),": Asynchronous goal-oriented communication for long-running tasks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Parameters"}),": Dynamic configuration system for ROS 2 nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node Composition"}),": Running multiple nodes in the same process"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Lifecycle Nodes"}),": Nodes with well-defined states and transitions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ROS 2 Client Libraries"}),": Different language implementations (rclpy for Python, rclcpp for C++)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"chapter-outline",children:"Chapter Outline"}),"\n",(0,r.jsx)(n.p,{children:"This chapter progresses from basic node enhancement to advanced ROS 2 features:"}),"\n",(0,r.jsx)(n.h3,{id:"1-advanced-node-development",children:"1. Advanced Node Development"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creating nodes with services"}),"\n",(0,r.jsx)(n.li,{children:"Implementing parameter management"}),"\n",(0,r.jsx)(n.li,{children:"Error handling and recovery strategies"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-services-and-actions",children:"2. Services and Actions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request-response communication patterns"}),"\n",(0,r.jsx)(n.li,{children:"Designing custom service types"}),"\n",(0,r.jsx)(n.li,{children:"Implementing action servers and clients"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-message-types-and-parameters",children:"3. Message Types and Parameters"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Custom message definitions"}),"\n",(0,r.jsx)(n.li,{children:"Parameter declarations and usage"}),"\n",(0,r.jsx)(n.li,{children:"Dynamic parameter updates"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-package-organization",children:"4. Package Organization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Best practices for structuring ROS 2 packages"}),"\n",(0,r.jsx)(n.li,{children:"Resource management and cleanup"}),"\n",(0,r.jsx)(n.li,{children:"Testing and debugging strategies"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"hands-on-lab",children:"Hands-On Lab"}),"\n",(0,r.jsx)(n.h3,{id:"creating-the-robot-control-basics-package",children:"Creating the Robot Control Basics Package"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Navigate to your ROS 2 workspace:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/robotics_ws/src\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Create a new package for robot control basics:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 pkg create --build-type ament_python robot_control_basics\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Create the velocity publisher node in ",(0,r.jsx)(n.code,{children:"robot_control_basics/robot_control_basics/vel_publisher_node.py"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom std_msgs.msg import Float64\n\n\nclass VelPublisherNode(Node):\n    def __init__(self):\n        super().__init__('vel_publisher')\n\n        # Create publisher for cmd_vel topic\n        self.vel_publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n\n        # Create subscriber for target velocity\n        self.target_subscriber = self.create_subscription(\n            Float64,\n            'target_velocity',\n            self.target_velocity_callback,\n            10\n        )\n\n        # Declare parameters\n        self.declare_parameter('linear_velocity', 0.5)\n        self.declare_parameter('angular_velocity', 0.25)\n\n        # Get parameter values\n        self.linear_vel = self.get_parameter('linear_velocity').value\n        self.angular_vel = self.get_parameter('angular_velocity').value\n\n        # Timer for publishing velocity commands\n        timer_period = 0.1  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n        self.get_logger().info('Velocity Publisher Node initialized')\n\n    def target_velocity_callback(self, msg):\n        self.linear_vel = msg.data\n        self.get_logger().info(f'Updated linear velocity to: {self.linear_vel}')\n\n    def timer_callback(self):\n        msg = Twist()\n        msg.linear.x = self.linear_vel\n        msg.angular.z = self.angular_vel\n        self.vel_publisher.publish(msg)\n        self.get_logger().info(f'Publishing velocity: linear={msg.linear.x}, angular={msg.angular.z}')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = VelPublisherNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["Create the scan subscriber node in ",(0,r.jsx)(n.code,{children:"robot_control_basics/robot_control_basics/scan_subscriber_node.py"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nfrom std_msgs.msg import String\n\n\nclass ScanSubscriberNode(Node):\n    def __init__(self):\n        super().__init__('scan_subscriber')\n\n        # Create subscriber for laser scan data\n        self.scan_subscription = self.create_subscription(\n            LaserScan,\n            'scan',\n            self.scan_callback,\n            10\n        )\n\n        # Create publisher for obstacle detection\n        self.obstacle_publisher = self.create_publisher(String, 'obstacle_alert', 10)\n\n        # Declare parameters\n        self.declare_parameter('obstacle_distance_threshold', 1.0)\n\n        # Get parameter values\n        self.threshold = self.get_parameter('obstacle_distance_threshold').value\n\n        self.get_logger().info('Scan Subscriber Node initialized')\n\n    def scan_callback(self, msg):\n        # Check if any range reading is below the threshold\n        min_distance = min(msg.ranges)\n\n        if min_distance < self.threshold:\n            alert_msg = String()\n            alert_msg.data = f'OBSTACLE_DETECTED: {min_distance:.2f}m'\n            self.obstacle_publisher.publish(alert_msg)\n            self.get_logger().warn(f'Obstacle detected at {min_distance:.2f}m')\n        else:\n            self.get_logger().info(f'Clear path: {min_distance:.2f}m')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ScanSubscriberNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["Update the ",(0,r.jsx)(n.code,{children:"setup.py"})," file in ",(0,r.jsx)(n.code,{children:"robot_control_basics/setup.py"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import os\nfrom glob import glob\nfrom setuptools import setup\nfrom setuptools import find_packages\n\npackage_name = 'robot_control_basics'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=find_packages(exclude=['test']),\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Humanoid Robotics Book',\n    maintainer_email='humanoid-robotics-book@example.com',\n    description='Robot control basics for the Physical AI & Humanoid Robotics book',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'vel_publisher = robot_control_basics.vel_publisher_node:main',\n            'scan_subscriber = robot_control_basics.scan_subscriber_node:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsxs)(n.li,{children:["Create the package.xml file in ",(0,r.jsx)(n.code,{children:"robot_control_basics/package.xml"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>robot_control_basics</name>\n  <version>0.0.0</version>\n  <description>Robot control basics for the Physical AI & Humanoid Robotics book</description>\n  <maintainer email="humanoid-robotics-book@example.com">Humanoid Robotics Book</maintainer>\n  <license>Apache-2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>geometry_msgs</depend>\n  <depend>sensor_msgs</depend>\n\n  <test_depend>ament_copyright</test_depend>\n  <test_depend>ament_flake8</test_depend>\n  <test_depend>ament_pep257</test_depend>\n  <test_depend>python3-pytest</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsx)(n.li,{children:"Build the package:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/robotics_ws\ncolcon build --packages-select robot_control_basics\nsource install/setup.bash\n"})}),"\n",(0,r.jsx)(n.h2,{id:"safety-notes",children:"Safety Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Always implement safety limits in velocity commands to prevent robot damage"}),"\n",(0,r.jsx)(n.li,{children:"Use appropriate obstacle detection and avoidance strategies"}),"\n",(0,r.jsx)(n.li,{children:"Test all control algorithms in simulation before physical robot deployment"}),"\n",(0,r.jsx)(n.li,{children:"Implement emergency stop mechanisms in all control nodes"}),"\n",(0,r.jsx)(n.li,{children:"Monitor robot behavior during testing and have manual override available"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"evaluation-criteria",children:"Evaluation Criteria"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Can you successfully create and run the velocity publisher and scan subscriber nodes?"}),"\n",(0,r.jsx)(n.li,{children:"Do you understand how to use ROS 2 parameters for configuration?"}),"\n",(0,r.jsx)(n.li,{children:"Can you implement custom message handling for robot control?"}),"\n",(0,r.jsx)(n.li,{children:"Are you able to use ROS 2 tools for debugging and monitoring?"}),"\n",(0,r.jsx)(n.li,{children:"Can you structure a ROS 2 package following best practices?"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const r={},a=i.createContext(r);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);